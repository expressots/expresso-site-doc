"use strict";(self.webpackChunkclassic=self.webpackChunkclassic||[]).push([[6803],{6094:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>p,frontMatter:()=>a,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"features/in-memory-db","title":"DB in memory","description":"A simple in memory database to store data.","source":"@site/docs/features/in-memory-db.mdx","sourceDirName":"features","slug":"/features/in-memory-db","permalink":"/docs/next/features/in-memory-db","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":9,"frontMatter":{"sidebar_position":9,"title":"DB in memory","description":"A simple in memory database to store data."},"sidebar":"tutorialSidebar","previous":{"title":"Env validator","permalink":"/docs/next/features/envvalidator"},"next":{"title":"Logger","permalink":"/docs/next/features/logging"}}');var r=s(4848),i=s(8453);const a={sidebar_position:9,title:"DB in memory",description:"A simple in memory database to store data."},o="In memory DB",c={},d=[{value:"DB inspector",id:"db-inspector",level:2},{value:"Register InMemoryDB",id:"register-inmemorydb",level:2},{value:"Create an entity",id:"create-an-entity",level:2},{value:"Repository pattern",id:"repository-pattern",level:2},{value:"Create a repository",id:"create-a-repository",level:2},{value:"Define custom methods",id:"define-custom-methods",level:2},{value:"Usage in a use case",id:"usage-in-a-use-case",level:2},{value:"Support us \u2764\ufe0f",id:"support-us-\ufe0f",level:2}];function l(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"in-memory-db",children:"In memory DB"})}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)("span",{class:"span-table",children:"In-memory-db"})," is a provider that uses a simple in memory database to store\ndata. It is a class that can be registered in the ExpressoTS dependency injection system as a singleton."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-ts",children:'this.provider.register(InMemoryDB, "Singleton");\n'})}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"InMemoryDB"})," class provides a simple and efficient way to simulate a database entirely in-memory, which can be particularly useful for testing and rapid development where a full-fledged database might be overkill."]}),"\n",(0,r.jsx)(t.h2,{id:"db-inspector",children:"DB inspector"}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"InMemoryDB"})," class have the ability to print tables to the console. This feature is particularly useful for debugging and testing purposes. It can also be used to quickly inspect the contents of a table."]}),"\n",(0,r.jsx)(t.p,{children:"The table content will be printed to the console every time the repository is used by any endpoint that have operations that read or write to the database."}),"\n",(0,r.jsxs)(t.p,{children:["Here is an image showing the output in the console of the ",(0,r.jsx)(t.code,{children:"InMemoryDB"})," when we create a new user:"]}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.img,{alt:"Application Overview",src:s(8732).A+"",width:"868",height:"145"})}),"\n",(0,r.jsx)(t.admonition,{type:"info",children:(0,r.jsx)(t.p,{children:"The DB inspector is enabled by default. As soon as you create a new entity and extend the BaseRepository class, the InMemoryDB will print the table to the console."})}),"\n",(0,r.jsx)(t.h2,{id:"register-inmemorydb",children:"Register InMemoryDB"}),"\n",(0,r.jsxs)(t.p,{children:["To use the ",(0,r.jsx)(t.code,{children:"InMemoryDB"})," class, you need to import it from the ",(0,r.jsx)(t.code,{children:"@expressots/core"})," package and register it as a singleton in the dependency injection system. Here is an example of how to do this in a service class:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-typescript",children:'import { InMemoryDB } from "@expressots/core";\n\nexport class App extends AppExpress {\n    protected configureServices(): void {\n        this.Provider.register(InMemoryDB, "Singleton");\n    }\n}\n'})}),"\n",(0,r.jsxs)(t.p,{children:["When registering the ",(0,r.jsx)(t.code,{children:"InMemoryDB"})," class, you can specify the scope as ",(0,r.jsx)(t.code,{children:"string"})," or using the ",(0,r.jsx)(t.code,{children:"BindingScopeEnum"}),"."]}),"\n",(0,r.jsx)(t.h2,{id:"create-an-entity",children:"Create an entity"}),"\n",(0,r.jsx)(t.p,{children:"Create an entity to represent the data that will be stored in the database. The entity class should have properties that represent the fields of the data that will be stored in the database."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-typescript",children:"@provide(UserEntity)\nexport class UserEntity {\n    id: string;\n    name: string;\n    email: string;\n\n    constructor() {\n        this.id = randomUUID();\n    }\n}\n"})}),"\n",(0,r.jsx)(t.h2,{id:"repository-pattern",children:"Repository pattern"}),"\n",(0,r.jsx)(t.p,{children:"The repository pattern is a design pattern that abstracts the data access logic from the rest of the application. It provides a way to access and manipulate data in the database without exposing the details of the database to the rest of the application."}),"\n",(0,r.jsxs)(t.p,{children:["Read more about the repository pattern in here: ",(0,r.jsx)(t.a,{href:"/docs/next/guides/repositories",children:"Repositories"}),"."]}),"\n",(0,r.jsx)(t.h2,{id:"create-a-repository",children:"Create a repository"}),"\n",(0,r.jsxs)(t.p,{children:["The repository is a class that extends the ",(0,r.jsx)(t.code,{children:"BaseRepository"})," class and is used to manage entities of a specific type. The repository class is part of the dependency injection system and is marked by the @provide decorator."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-typescript",children:'@provide(UserRepository)\nexport class UserRepository extends BaseRepository<UserEntity> {\n    constructor() {\n        super("users");\n    }\n}\n'})}),"\n",(0,r.jsxs)(t.p,{children:["In the class above, we are creating a repository for the ",(0,r.jsx)(t.code,{children:"UserEntity"})," class. The repository is initialized with the table name ",(0,r.jsx)(t.code,{children:"users"})," in the constructor, as well as the entity class ",(0,r.jsx)(t.code,{children:"UserEntity"}),"."]}),"\n",(0,r.jsxs)(t.p,{children:["By extending the ",(0,r.jsx)(t.code,{children:"BaseRepository"})," class, the ",(0,r.jsx)(t.code,{children:"UserRepository"})," class inherits all the CRUD methods for managing entities in the database."]}),"\n",(0,r.jsx)(t.h2,{id:"define-custom-methods",children:"Define custom methods"}),"\n",(0,r.jsx)(t.p,{children:"You can also define custom methods for the user repository."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-typescript",children:'@provide(UserRepository)\nclass UserRepository extends BaseRepository<UserEntity> {\n    constructor() {\n        super("users");\n    }\n\n    findByEmail(email: string): User | null {\n        const user = this.table.find((item) => item.email === email);\n        return user || null;\n    }\n}\n'})}),"\n",(0,r.jsx)(t.h2,{id:"usage-in-a-use-case",children:"Usage in a use case"}),"\n",(0,r.jsx)(t.p,{children:"You can inject the repository in the constructor or via property injection. Example:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-typescript",metastring:'title="Injecting repository via property injection"',children:"@provide(UserCreateUseCase)\nexport class UserCreateUseCase {\n    @inject(UserRepository) private userRepo: UserRepository;\n    @inject(UserEntity) private userEntity: UserEntity;\n\n    execute(payload: IUserCreateRequestDTO): IUserCreateResponseDTO {\n        this.userEntity.name = payload.name;\n        this.userEntity.email = payload.email;\n\n        this.userRepo.create(this.userEntity);\n\n        return {\n            id: this.userEntity.id,\n            name: this.userEntity.name,\n            email: this.userEntity.email,\n        };\n    }\n}\n"})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-typescript",metastring:'title="Injecting repository in the constructor"',children:"@provide(UserCreateUseCase)\nexport class UserCreateUseCase {\n    constructor(\n        @inject(UserEntity) private userEntity: UserEntity,\n        @inject(UserRepository) private userRepo: UserRepository\n    ) {}\n\n    execute(payload: IUserCreateRequestDTO): IUserCreateResponseDTO {\n        this.userEntity.name = payload.name;\n        this.userEntity.email = payload.email;\n\n        this.userRepo.create(this.userEntity);\n\n        return {\n            id: this.userEntity.id,\n            name: this.userEntity.name,\n            email: this.userEntity.email,\n        };\n    }\n}\n"})}),"\n",(0,r.jsxs)(t.p,{children:["Once a request is made to the ",(0,r.jsx)(t.code,{children:"UserCreateUseCase"}),":"]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["The ",(0,r.jsx)(t.code,{children:"UserEntity"})," is populated with the request data."]}),"\n",(0,r.jsxs)(t.li,{children:["The entity is created in the database using the ",(0,r.jsx)(t.code,{children:"UserRepository"}),"."]}),"\n",(0,r.jsx)(t.li,{children:"The response data is then returned to the client."}),"\n",(0,r.jsxs)(t.li,{children:["The ",(0,r.jsx)(t.code,{children:"InMemoryDB"})," will print the table to the console, showing the newly created entity."]}),"\n"]}),"\n",(0,r.jsx)(t.hr,{}),"\n",(0,r.jsx)(t.h2,{id:"support-us-\ufe0f",children:"Support us \u2764\ufe0f"}),"\n",(0,r.jsxs)(t.p,{children:["ExpressoTS is an MIT-licensed open source project. It's an independent project with ongoing development made possible thanks to your support.\nIf you'd like to help, please read our ",(0,r.jsx)(t.strong,{children:(0,r.jsx)(t.a,{href:"/docs/next/support-us",children:"support guide"})}),"."]})]})}function p(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},8732:(e,t,s)=>{s.d(t,{A:()=>n});const n=s.p+"assets/images/inMemoryDB-8ced423ed2a118acfd702a9b96c85e98.png"},8453:(e,t,s)=>{s.d(t,{R:()=>a,x:()=>o});var n=s(6540);const r={},i=n.createContext(r);function a(e){const t=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),n.createElement(i.Provider,{value:t},e.children)}}}]);